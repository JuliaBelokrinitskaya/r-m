const CHARACTER_URL="https://rickandmortyapi.com/api/character/";let characters=[],width=window.innerWidth,height=window.innerHeight,id=1;const getCharacter=({name:t,image:e,location:a})=>({id:id++,name:t,image:e,location:a.name,value:2*(Math.random()+1),rotate:40*(Math.random()-.5)});function getHierarchy(t,e){let a={name:"",children:[]};return d3.group(t,t=>t[e]).forEach((t,e)=>{a.children.push({name:e,rotate:40*(Math.random()-.5),children:t})}),d3.hierarchy(a).sum(t=>t.value).sort((t,e)=>Math.random())}function pack(t,e){return d3.pack().size([width,height]).padding(10)(getHierarchy(t,e))}const getPage=(t,e)=>fetch(`${t}?page=${e}`).then(t=>t.json()).then(t=>{characters=characters.concat(t.results)}),getAllCharacters=t=>{let e=[];fetch(t).then(t=>t.json()).then(a=>{for(let r=1;r<=a.info.pages;r++)e.push(getPage(t,r));Promise.all(e).then((function(){const t=pack(characters=characters.map(t=>getCharacter(t)),"location");let e,a=t,r=Math.floor(80*Math.random())+180;const n=d3.scaleLinear().domain([0,20]).range([`hsl(${(r+30)%360},50%,40%)`,`hsl(${(r-30)%360},70%,70%)`]).interpolate(d3.interpolateHcl),i=d3.create("svg").classed("circle-pack",!0).attr("viewBox",`-${width/2} -${height/2} ${width} ${height}`).style("background-color",`hsl(${r}, 60%, 10%)`).on("click",()=>p(t)),d=i.append("g").attr("pointer-events","none").selectAll("g").data(t.descendants().slice(1)).join("g"),c=d.filter(t=>!t.data.id).append("circle").attr("fill",t=>n(20*Math.random())),o=d.filter(t=>t.data.id).append("clipPath").attr("id",t=>`circle-${t.data.id}`).append("circle"),h=d.filter(t=>t.data.id).append("image").attr("clip-path",t=>`url(#circle-${t.data.id})`).attr("xlink:href",t=>t.data.image),l=i.append("g").selectAll("foreignObject").data(t.descendants()).join("foreignObject").style("overflow","visible").classed("hidden",e=>e.parent!==t).on("click",t=>a!==t&&(p(t),d3.event.stopPropagation()));l.append("xhtml:div").classed("circle-pack__label",!0).append("p").style("transform",t=>`rotate(${t.data.rotate}deg)`).text(t=>t.data.name);function s(t){const a=Math.min(width,height)/t[2];e=t,l.attr("transform",e=>`translate(${(e.x-t[0]-e.r)*a},${(e.y-t[1]-e.r)*a})`),l.attr("width",t=>t.r*a*2),l.attr("height",t=>t.r*a*2),d.attr("transform",e=>`translate(${(e.x-t[0])*a},${(e.y-t[1])*a})`),c.attr("r",t=>t.r*a),o.attr("r",t=>t.r*a),o.attr("cx",t=>t.r*a),o.attr("cy",t=>t.r*a),h.attr("transform",t=>`translate(${-t.r*a},${-t.r*a})`),h.attr("width",t=>t.r*a*2),h.attr("height",t=>t.r*a*2)}function p(t){a=t;const r=i.transition().duration(d3.event.altKey?7500:750).tween("zoom",t=>{const r=d3.interpolateZoom(e,[a.x,a.y,2*a.r]);return t=>s(r(t))});l.classed("hidden",t=>t.parent!==a).filter((function(t){return t.parent===a||"inline"===this.style.display})).transition(r)}s([t.x,t.y,2*t.r]),document.body.appendChild(i.node()),window.setTimeout((function(){p(t)}),1e3),window.addEventListener("resize",()=>{width=window.innerWidth,height=window.innerHeight,i.attr("viewBox",`-${width/2} -${height/2} ${width} ${height}`),s([t.x,t.y,2*t.r])})}))})};getAllCharacters(CHARACTER_URL);