const CHARACTER_URL="https://rickandmortyapi.com/api/character/";let characters=[],width=window.innerWidth,height=window.innerHeight,id=1;const getCharacter=({name:t,image:e,location:a})=>({id:id++,name:t,image:e,location:a.name,value:1});function getHierarchy(t,e){let a={name:"",children:[]};return d3.group(t,t=>t[e]).forEach((t,e)=>{a.children.push({name:e,children:t})}),d3.hierarchy(a).sum(t=>t.value).sort((t,e)=>e.value-t.value)}function pack(t,e){return d3.pack().size([width,height]).padding(10)(getHierarchy(t,e))}const getPage=(t,e)=>fetch(`${t}?page=${e}`).then(t=>t.json()).then(t=>{characters=characters.concat(t.results)}),getAllCharacters=t=>{let e=[];fetch(t).then(t=>t.json()).then(a=>{for(let n=1;n<=a.info.pages;n++)e.push(getPage(t,n));Promise.all(e).then((function(){const t=pack(characters=characters.map(t=>getCharacter(t)),"location");let e,a=t;const n=d3.scaleLinear().domain([0,5]).range(["hsl(152,80%,80%)","hsl(228,30%,40%)"]).interpolate(d3.interpolateHcl),r=d3.create("svg").classed("circle-pack",!0).attr("viewBox",`-${width/2} -${height/2} ${width} ${height}`).on("click",()=>h(t)),i=r.append("g").selectAll("g").data(t.descendants().slice(1)).join("g").attr("pointer-events",t=>t.children?null:"none").on("mouseover",(function(){d3.select(this).attr("stroke","#ffffff")})).on("mouseout",(function(){d3.select(this).attr("stroke",null)})).on("click",t=>a!==t&&(h(t),d3.event.stopPropagation())),c=i.filter(t=>!t.data.id).append("circle").attr("fill",t=>n(t.depth+Math.random())),o=i.filter(t=>t.data.id).append("clipPath").attr("id",t=>`circle-${t.data.id}`).append("circle"),l=i.filter(t=>t.data.id).append("image").attr("clip-path",t=>`url(#circle-${t.data.id})`).attr("xlink:href",t=>t.data.image),d=r.append("g").style("font","10px sans-serif").attr("pointer-events","none").attr("text-anchor","middle").selectAll("text").data(t.descendants()).join("text").style("fill-opacity",e=>e.parent===t?1:0).style("display",e=>e.parent===t?"inline":"none").text(t=>t.data.name);function s(t){const a=Math.min(width,height)/t[2];e=t,d.attr("transform",e=>`translate(${(e.x-t[0])*a},${(e.y-t[1]+(e.data.id?e.r/2:0))*a})`),i.attr("transform",e=>`translate(${(e.x-t[0])*a},${(e.y-t[1])*a})`),c.attr("r",t=>t.r*a),o.attr("r",t=>t.r*a),o.attr("cx",t=>t.r*a),o.attr("cy",t=>t.r*a),l.attr("transform",t=>`translate(${-t.r*a},${-t.r*a})`),l.attr("width",t=>t.r*a*2),l.attr("height",t=>t.r*a*2)}function h(t){a=t;const n=r.transition().duration(d3.event.altKey?7500:750).tween("zoom",t=>{const n=d3.interpolateZoom(e,[a.x,a.y,2*a.r]);return t=>s(n(t))});d.filter((function(t){return t.parent===a||"inline"===this.style.display})).transition(n).style("fill-opacity",t=>t.parent===a?1:0).on("start",(function(t){t.parent===a&&(this.style.display="inline")})).on("end",(function(t){t.parent!==a&&(this.style.display="none")}))}s([t.x,t.y,2*t.r]),document.body.appendChild(r.node()),window.addEventListener("resize",()=>{width=window.innerWidth,height=window.innerHeight,r.attr("viewBox",`-${width/2} -${height/2} ${width} ${height}`),s([t.x,t.y,2*t.r])})}))})};getAllCharacters(CHARACTER_URL);